<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Environmental data from an extent with raadtools • raadtools</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">raadtools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/AustralianAntarcticDivision/raadtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Environmental data from an extent with raadtools</h1>
                        <h4 class="author">Michael Sumner and Jaimie Cleeland</h4>
            
            <h4 class="date">2017-06-17</h4>
          </div>

    
    
<div class="contents">
<p>The <code>raadtools</code> package contains a number of <code>read[something]</code> functions, mostly for gridded time-series remote sensing data.</p>
<p>All of the read functions have an “xylim” argument, which will take a <code>raster::extent(xmin, xmax, ymin, ymax)</code>. E.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raadtools)</code></pre></div>
<pre><code>## Loading required package: raster</code></pre>
<pre><code>## Loading required package: methods</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raadfiles)
<span class="kw"><a href="../reference/readsst.html">readsst</a></span>(<span class="st">"2010-01-01"</span>, <span class="dt">xylim =</span> <span class="kw">extent</span>(<span class="dv">100</span>, <span class="dv">160</span>, -<span class="dv">50</span>, -<span class="dv">40</span>))</code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 40, 240, 9600  (nrow, ncol, ncell)
## resolution  : 0.25, 0.25  (x, y)
## extent      : 100, 160, -50, -40  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       : Daily.sea.surface.temperature 
## values      : 4.41, 19.24  (min, max)</code></pre>
<p>That extent must make sense for the data set though, so see what this returns first (it will be a longlat-grid in [-180, 180, -90, 90].</p>
<p>Note that we ran the function above <em>without saving the result anywhere</em>, so we just saw a print-out summary of the result but it is now discarded.</p>
<p>That is a useful technique to see what a function does, since it will return a layer by default. This can be plotted or used by other functions, and so is the best way to learn about the data source.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raadtools)
<span class="kw">library</span>(raadfiles)
<span class="kw"><a href="../reference/readsst.html">readsst</a></span>()</code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 720, 1440, 1036800  (nrow, ncol, ncell)
## resolution  : 0.25, 0.25  (x, y)
## extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       : Daily.sea.surface.temperature 
## values      : -1.8, 33.74  (min, max)</code></pre>
<p>That works for <code>readssh</code>, <code>readcurr</code>, and <code>readwind</code> just the same, and the date argument can be a single date or a vector of them. In the <code>raster</code> package there are single <code>RasterLayer</code> objects and multi-layer <code>RasterBrick</code> (or <code>RasterStack</code>) objects. Raadtools will usually return a RasterStack or a RasterLayer, and it will record the time-step/s on the data as well (when relevant). After the read function is finished we are back to using the <code>raster</code> package, so familiarity with that package and its documentation is important.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vignette</span>(<span class="st">"Raster"</span>, <span class="dt">package=</span> <span class="st">"raster"</span>)</code></pre></div>
<p>Some of the functions respect <code>lon180 = FALSE</code> because they have a grid that was originally in <code>[0, 360, -90, 90]</code> and in that case it can be faster to use that domain for the extent rather than the common <code>[-180, 180, -90, 90]</code> one. (Please feel free to ask about this for specific data sets, it’s one of those boring details).</p>
<p>For ice, and some other data, the grids are not in longlat so <code>xylim</code> needs an extent in that projection. You can always draw one like this, with code that must be run interactively as the plot will wait for you to click twice on the plot (defining a rectangle) before the <code>e</code> object is created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ice &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readice.html">readice</a></span>()  
<span class="kw">plot</span>(ice)
e &lt;-<span class="st"> </span><span class="kw">drawExtent</span>()</code></pre></div>
<p><img src="extract-extent_files/figure-html/unnamed-chunk-6-1.png" width="672"> Notice that we can also make <code>Extent</code> objects from scratch, and perform operations on them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_extent &lt;-<span class="st"> </span><span class="kw">extent</span>(<span class="dv">100</span>, <span class="dv">120</span>, -<span class="dv">40</span>, -<span class="dv">20</span>)
my_extent</code></pre></div>
<pre><code>## class       : Extent 
## xmin        : 100 
## xmax        : 120 
## ymin        : -40 
## ymax        : -20</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_extent +<span class="st"> </span><span class="dv">10</span></code></pre></div>
<pre><code>## class       : Extent 
## xmin        : 95 
## xmax        : 125 
## ymin        : -45 
## ymax        : -15</code></pre>
<p>otherwise there are functions <code>projectExtent</code> and some others to do it more automatically. It’s not that straightforward because of the polar aspect.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raadtools)
<span class="kw">library</span>(raadfiles)
ice &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readice.html">readice</a></span>() 
rex &lt;-<span class="st"> </span><span class="kw">raster</span>( <span class="kw">extent</span>(<span class="dv">100</span>, <span class="dv">160</span>, -<span class="dv">70</span>, -<span class="dv">50</span>), <span class="dt">crs =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>)
pex &lt;-<span class="st"> </span><span class="kw">projectExtent</span>(rex, <span class="kw">projection</span>(ice))

## pex is a raster, not just an extent but that's good because
## it also has the CRS (it's nonsense to have an extent without CRS, but that's life)
ice_ex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readice.html">readice</a></span>(<span class="st">"2016-09-01"</span>, <span class="dt">xylim =</span> pex)

<span class="kw">plot</span>(ice_ex, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">100</span>)), <span class="dt">zlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">100</span>))</code></pre></div>
<p><img src="extract-extent_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>Please note that the <code>xylim</code> argument just applies <code>crop</code>, so you can avoid it altogether and do it after the fact.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raadtools)
<span class="kw">library</span>(raadfiles)
<span class="kw">crop</span>(<span class="kw"><a href="../reference/readsst.html">readsst</a></span>(),  <span class="kw">extent</span>(<span class="dv">100</span>, <span class="dv">160</span>, -<span class="dv">50</span>, -<span class="dv">40</span>), <span class="dt">snap =</span> <span class="st">"out"</span>)</code></pre></div>
<pre><code>## class       : RasterLayer 
## dimensions  : 40, 240, 9600  (nrow, ncol, ncell)
## resolution  : 0.25, 0.25  (x, y)
## extent      : 100, 160, -50, -40  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0 
## data source : in memory
## names       : Daily.sea.surface.temperature 
## values      : 1.93, 13.76  (min, max)</code></pre>
<p>(Internally <code>raadtools</code> always uses <code>snap=out</code> since that makes sure the intersection is <em>inclusive</em>, i.e. any overlapping part of a pixel means that pixel is included in the result. By default <code>crop</code> would drop partial overlaps on the edge).</p>
<p>If there’s a really long time series though it will be better to do that with xylim, and even to pass it out to a file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sst &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readsst.html">readsst</a></span>(dates,  <span class="dt">xylim =</span> <span class="kw">extent</span>(<span class="dv">100</span>, <span class="dv">160</span>, -<span class="dv">50</span>, -<span class="dv">40</span>), <span class="dt">filename =</span> <span class="st">"mymegasplat.grd"</span>)</code></pre></div>
<p>More details … TBD</p>
<div id="extending-maps" class="section level2">
<h2 class="hasAnchor">
<a href="#extending-maps" class="anchor"></a>Extending maps</h2>
<p>With two examples from above.</p>
<p>Plot the projected data with a graticule, and add a “transect”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raadtools)
<span class="kw">library</span>(raadfiles)
ice &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readice.html">readice</a></span>() 
rex &lt;-<span class="st"> </span><span class="kw">raster</span>( <span class="kw">extent</span>(<span class="dv">100</span>, <span class="dv">160</span>, -<span class="dv">70</span>, -<span class="dv">50</span>), <span class="dt">crs =</span> <span class="st">"+proj=longlat +datum=WGS84"</span>)
pex &lt;-<span class="st"> </span><span class="kw">projectExtent</span>(rex, <span class="kw">projection</span>(ice))

## pex is a raster, not just an extent but that's good because
## it also has the CRS (it's nonsense to have an extent without CRS, but that's life)
ice_ex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readice.html">readice</a></span>(<span class="st">"2016-09-01"</span>, <span class="dt">xylim =</span> pex)

## create a graticule for this region

g &lt;-<span class="st"> </span>graticule::<span class="kw">graticule</span>(<span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">160</span>, <span class="dt">by =</span> <span class="dv">15</span>), <span class="kw">seq</span>(-<span class="dv">75</span>, -<span class="dv">50</span>, <span class="dt">by =</span> <span class="dv">5</span>), <span class="dt">proj =</span> <span class="kw">projection</span>(ice))</code></pre></div>
<pre><code>## returning a SpatialLinesDataFrame but a future release will be sf</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ice_ex, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length =</span> <span class="dv">100</span>)), <span class="dt">zlim =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">100</span>), <span class="dt">axes =</span> <span class="ot">FALSE</span>, 
     <span class="dt">addfun =</span> function() <span class="kw">plot</span>(g, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">"firebrick"</span>))

## add a "transect"
lons &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">160</span>, <span class="dt">by =</span> <span class="dv">1</span>)
transect &lt;-<span class="st"> </span>rgdal::<span class="kw">project</span>(<span class="kw">cbind</span>(lons, -<span class="dv">63</span>), <span class="kw">projection</span>(ice_ex))


<span class="kw">points</span>(transect, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">"dodgerblue"</span>)</code></pre></div>
<p><img src="extract-extent_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Extract values at specific points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raadtools)
<span class="kw">library</span>(raadfiles)
iceconc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/extract.html">extract</a></span>(ice_ex, transect, <span class="dt">method =</span> <span class="st">"bilinear"</span>)
<span class="kw">plot</span>(lons, iceconc, <span class="dt">main =</span> <span class="st">"ice concentration at latitude -65 between 100E and 160E"</span>)</code></pre></div>
<p><img src="extract-extent_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>Plot mean SST and contour.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raadtools)
<span class="kw">library</span>(raadfiles)
dates &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">as.Date</span>(<span class="st">"2016-01-01"</span>), <span class="dt">length =</span> <span class="dv">31</span>, <span class="dt">by =</span> <span class="st">"1 day"</span>)
sst &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readsst.html">readsst</a></span>(dates,  <span class="dt">xylim =</span> <span class="kw">extent</span>(<span class="dv">100</span>, <span class="dv">160</span>, -<span class="dv">50</span>, -<span class="dv">40</span>))
msst &lt;-<span class="st"> </span><span class="kw">calc</span>(sst, mean)
sdsst &lt;-<span class="st"> </span><span class="kw">calc</span>(sst, sd)
<span class="kw">plot</span>(msst, <span class="dt">col =</span> viridis::<span class="kw">viridis</span>(<span class="dv">50</span>), <span class="dt">main =</span> <span class="st">"mean SST Jan 2016"</span>,  <span class="dt">addfun =</span> function() <span class="kw">contour</span>(sdsst, <span class="dt">add =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><img src="extract-extent_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#extending-maps">Extending maps</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
